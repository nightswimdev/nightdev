<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>nightdev | Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- NightDev Analytics & IP Tracking -->
  <script src="analytics.js" defer></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap");

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Roboto", Arial, Helvetica, sans-serif;
      margin: 0px;
      background-color: #050505;
      background-image:
        radial-gradient(circle at 50% 50%, #05050580 0%, rgb(5, 5, 5) 80%),
        linear-gradient(#2a2a2a 1px, transparent 1px),
        linear-gradient(to right, #2a2a2a 1px, #050505 1px);
      background-size: 100% 100%, 25px 25px, 25px 25px;
      min-height: 100vh;
      color: #e0e0e0;
      overflow-x: hidden;
      animation: fadeIn 0.4s ease;
      scroll-behavior: smooth;
      position: relative;
      z-index: 1;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Layout Container */
    .dashboard-layout {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, #000000 0%, #0a0a0a 100%);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      position: fixed;
      height: 100vh;
      left: 0;
      top: 0;
      z-index: 1000;
      overflow-y: auto;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      padding: 2rem 1.5rem 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.4rem;
      font-weight: 500;
      color: #e0e0e0;
      margin-bottom: 0.5rem;
    }

    .sidebar-logo i {
      font-size: 1.6rem;
      background: linear-gradient(135deg, #333, #555);
      padding: 0.5rem;
      border-radius: 8px;
    }

    .sidebar-subtitle {
      color: #888;
      font-size: 0.85rem;
      margin-left: 2.85rem;
    }

    .sidebar-nav {
      padding: 1rem 0;
    }

    .nav-section {
      margin-bottom: 2rem;
    }

    .nav-section-title {
      color: #666;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 0 1.5rem;
      margin-bottom: 0.75rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.5rem;
      color: #aaa;
      text-decoration: none;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
      position: relative;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.05);
      color: #e0e0e0;
      border-left-color: rgba(255, 255, 255, 0.3);
    }

    .nav-item.active {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border-left-color: #e0e0e0;
    }

    .nav-item i {
      width: 20px;
      text-align: center;
      font-size: 1rem;
    }

    .nav-item-text {
      font-size: 0.9rem;
      font-weight: 400;
    }

    .coming-soon-badge {
      background: rgba(255, 193, 7, 0.2);
      border: 1px solid rgba(255, 193, 7, 0.4);
      color: #ffc107;
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 500;
      margin-left: auto;
    }

    .nav-badge {
      background: #ff4444;
      color: white;
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
      margin-left: auto;
    }

    /* Header */
    .header {
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-left: 280px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: #e0e0e0;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 6px;
      transition: background 0.3s ease;
    }

    .menu-toggle:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 500;
      color: #e0e0e0;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #333, #555);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e0e0e0;
      font-size: 0.9rem;
    }

    .logout-btn {
      background: linear-gradient(135deg, #2a2a2a, #404040);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e0e0e0;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .logout-btn:hover {
      background: linear-gradient(135deg, #404040, #555555);
      border-color: rgba(255, 255, 255, 0.2);
    }

    /* Main Content */
    .main-content {
      margin-left: 280px;
      padding: 2rem;
      min-height: calc(100vh - 80px);
      width: calc(100% - 280px);
    }

    .welcome-section {
      background: linear-gradient(135deg, #000000 0%, #000000 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(255, 255, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .welcome-title {
      font-size: 2rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #ffffff, #cccccc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .dashboard-card {
      background: linear-gradient(135deg, #000000 0%, #000000 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.05);
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    .card-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #e0e0e0;
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: #e0e0e0;
    }

    .card-description {
      color: #aaaaaa;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: 2rem;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(224, 224, 224, 0.3);
      border-top: 3px solid #e0e0e0;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
      
      .header {
        margin-left: 0;
      }
      
      .main-content {
        margin-left: 0;
        width: 100%;
      }
      
      .menu-toggle {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 1rem;
      }
      
      .main-content {
        padding: 1rem;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .page-title {
        font-size: 1.2rem;
      }
      
      .user-info span {
        display: none;
      }
    }

    /* Sidebar Overlay for Mobile */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }

    @media (max-width: 1024px) {
      .sidebar-overlay.active {
        display: block;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar Overlay for Mobile -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <i class="fa-solid fa-code"></i>
        <span>nightdev</span>
      </div>
      <div class="sidebar-subtitle">Admin Dashboard</div>
    </div>

    <nav class="sidebar-nav">
      <!-- Main Section -->
      <div class="nav-section">
        <div class="nav-section-title">Main</div>
        <a href="#" class="nav-item active" data-page="dashboard">
          <i class="fa-solid fa-home"></i>
          <span class="nav-item-text">Dashboard</span>
        </a>
        <a href="#" class="nav-item" data-page="analytics">
          <i class="fa-solid fa-chart-line"></i>
          <span class="nav-item-text">Analytics</span>
        </a>
        <a href="#" class="nav-item" data-page="ip-data">
          <i class="fa-solid fa-globe"></i>
          <span class="nav-item-text">IP Data</span>
          <span class="nav-badge">New</span>
        </a>
      </div>

      <!-- Management Section -->
      <div class="nav-section">
        <div class="nav-section-title">Management</div>
        <a href="#" class="nav-item" data-page="users" onclick="showComingSoon('User Management')">
          <i class="fa-solid fa-users"></i>
          <span class="nav-item-text">User Management</span>
          <span class="coming-soon-badge">Soon</span>
        </a>
        <a href="#" class="nav-item" data-page="logs" onclick="showComingSoon('System Logs')">
          <i class="fa-solid fa-file-alt"></i>
          <span class="nav-item-text">System Logs</span>
          <span class="coming-soon-badge">Soon</span>
        </a>
        <a href="#" class="nav-item" data-page="security" onclick="showComingSoon('Security')">
          <i class="fa-solid fa-shield-alt"></i>
          <span class="nav-item-text">Security</span>
          <span class="coming-soon-badge">Soon</span>
        </a>
        <a href="#" class="nav-item" data-page="database" onclick="showComingSoon('Database Management')">
          <i class="fa-solid fa-database"></i>
          <span class="nav-item-text">Database</span>
          <span class="coming-soon-badge">Soon</span>
        </a>
      </div>

      <!-- Tools Section -->
      <div class="nav-section">
        <div class="nav-section-title">Tools</div>
        <a href="#" class="nav-item" data-page="api" onclick="showComingSoon('API Console')">
          <i class="fa-solid fa-code"></i>
          <span class="nav-item-text">API Console</span>
          <span class="coming-soon-badge">Soon</span>
        </a>
        <a href="#" class="nav-item" data-page="monitoring" onclick="showComingSoon('System Monitoring')">
          <i class="fa-solid fa-desktop"></i>
          <span class="nav-item-text">Monitoring</span>
          <span class="coming-soon-badge">Soon</span>
        </a>
        <a href="#" class="nav-item" data-page="backups" onclick="showComingSoon('Backup Management')">
          <i class="fa-solid fa-cloud-upload-alt"></i>
          <span class="nav-item-text">Backups</span>
          <span class="coming-soon-badge">Soon</span>
        </a>
      </div>

      <!-- Settings Section -->
      <div class="nav-section">
        <div class="nav-section-title">Settings</div>
        <a href="account-settings.html" class="nav-item" data-page="account">
          <i class="fa-solid fa-user-cog"></i>
          <span class="nav-item-text">Account Settings</span>
        </a>
        <a href="#" class="nav-item" data-page="system" onclick="showComingSoon('System Settings')">
          <i class="fa-solid fa-cogs"></i>
          <span class="nav-item-text">System Settings</span>
          <span class="coming-soon-badge">Soon</span>
        </a>
        <a href="#" class="nav-item" data-page="notifications" onclick="showComingSoon('Notifications')">
          <i class="fa-solid fa-bell"></i>
          <span class="nav-item-text">Notifications</span>
          <span class="coming-soon-badge">Soon</span>
        </a>
      </div>
    </nav>
  </aside>

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <button class="menu-toggle" id="menuToggle">
        <i class="fa-solid fa-bars"></i>
      </button>
      <h1 class="page-title" id="pageTitle">Dashboard</h1>
    </div>
    <div class="user-info">
      <div class="user-avatar" id="userAvatar">
        <i class="fa-solid fa-user"></i>
      </div>
      <span id="userWelcome">Loading...</span>
      <button class="logout-btn" id="logoutBtn">
        <i class="fa-solid fa-sign-out-alt"></i> Logout
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Loading State -->
    <div id="loadingState" class="loading">
      <div class="spinner"></div>
      <p>Loading dashboard...</p>
    </div>

    <!-- Dashboard Content -->
    <div id="dashboardContent" style="display: none;">
      <!-- Welcome Section -->
      <section class="welcome-section">
        <h1 class="welcome-title">Welcome to your Dashboard</h1>
        <p style="color: #aaaaaa;">This is a development dashboard for nightdev. Here you can manage your projects and access developer tools.</p>
      </section>

      <!-- Dashboard Grid -->
      <div class="dashboard-grid">
        <div class="dashboard-card">
          <div class="card-icon">
            <i class="fa-solid fa-project-diagram"></i>
          </div>
          <h3 class="card-title">Projects</h3>
          <p class="card-description">Manage your development projects, view progress, and access project files.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-icon">
            <i class="fa-solid fa-chart-line"></i>
          </div>
          <h3 class="card-title">Analytics</h3>
          <p class="card-description">View performance metrics, user statistics, and development insights.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-icon">
            <i class="fa-solid fa-cog"></i>
          </div>
          <h3 class="card-title">Settings</h3>
          <p class="card-description">Configure your development environment, preferences, and account settings.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-icon">
            <i class="fa-solid fa-tools"></i>
          </div>
          <h3 class="card-title">Developer Tools</h3>
          <p class="card-description">Access debugging tools, API testing, and development utilities.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-icon">
            <i class="fa-solid fa-users"></i>
          </div>
          <h3 class="card-title">Team</h3>
          <p class="card-description">Manage team members, permissions, and collaborative development.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-icon">
            <i class="fa-solid fa-file-code"></i>
          </div>
          <h3 class="card-title">Documentation</h3>
          <p class="card-description">Access project documentation, API references, and development guides.</p>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Dashboard Authentication and Management
    class Dashboard {
      constructor() {
        this.currentUser = null;
        this.init();
      }

      async init() {
        // Check authentication
        if (!this.checkAuth()) {
          this.redirectToLogin();
          return;
        }

        // Load user data
        this.loadUserData();

        // Initialize event listeners
        this.initEventListeners();

        // Simulate loading
        setTimeout(() => {
          this.showDashboard();
        }, 1000);
      }

      checkAuth() {
        // Check for session in both localStorage and sessionStorage
        const localSession = localStorage.getItem('nightdev_session');
        const sessionSession = sessionStorage.getItem('nightdev_session');
        
        if (localSession || sessionSession) {
          try {
            this.currentUser = JSON.parse(localSession || sessionSession);
            return true;
          } catch (e) {
            // Clear invalid session data
            localStorage.removeItem('nightdev_session');
            sessionStorage.removeItem('nightdev_session');
            return false;
          }
        }
        return false;
      }

      loadUserData() {
        if (this.currentUser) {
          const userWelcome = document.getElementById('userWelcome');
          const userAvatar = document.getElementById('userAvatar');
          
          userWelcome.textContent = `Welcome, ${this.currentUser.username}`;
          
          // Set user avatar with first letter of username
          if (userAvatar && this.currentUser.username) {
            userAvatar.innerHTML = this.currentUser.username.charAt(0).toUpperCase();
          }
        }
      }

      showDashboard() {
        const loadingState = document.getElementById('loadingState');
        const dashboardContent = document.getElementById('dashboardContent');
        
        loadingState.style.display = 'none';
        dashboardContent.style.display = 'block';
      }

      initEventListeners() {
        // Logout button
        const logoutBtn = document.getElementById('logoutBtn');
        logoutBtn.addEventListener('click', () => {
          this.logout();
        });

        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        menuToggle.addEventListener('click', () => {
          sidebar.classList.toggle('open');
          sidebarOverlay.classList.toggle('active');
        });

        // Close sidebar when clicking overlay
        sidebarOverlay.addEventListener('click', () => {
          sidebar.classList.remove('open');
          sidebarOverlay.classList.remove('active');
        });

        // Navigation items
        const navItems = document.querySelectorAll('.nav-item');
        const pageTitle = document.getElementById('pageTitle');

        navItems.forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            
            // Remove active class from all items
            navItems.forEach(nav => nav.classList.remove('active'));
            
            // Add active class to clicked item
            item.classList.add('active');
            
            // Update page title
            const pageName = item.querySelector('.nav-item-text').textContent;
            pageTitle.textContent = pageName;
            
            // Close mobile menu if open
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
            
            // Handle page switching (you can expand this)
            this.switchPage(item.dataset.page);
          });
        });
      }

      async switchPage(page) {
        // This method can be expanded to handle different page content
        console.log(`Switching to page: ${page}`);
        
        // You can add logic here to show/hide different content sections
        // For now, we'll just update the dashboard content based on the selected page
        await this.updateDashboardContent(page);
      }

      async updateDashboardContent(page) {
        const welcomeSection = document.querySelector('.welcome-section');
        const dashboardGrid = document.querySelector('.dashboard-grid');
        
        // Update welcome section based on selected page
        const pageConfigs = {
          'dashboard': {
            title: 'Welcome to your Dashboard',
            description: 'This is a development dashboard for nightdev. Here you can manage your projects and access developer tools.'
          },
          'analytics': {
            title: 'Analytics Overview',
            description: 'View performance metrics, user statistics, and development insights.'
          },
          'ip-data': {
            title: 'IP Data Management',
            description: 'Monitor and analyze IP addresses, geolocation data, and network traffic.'
          },
          'users': {
            title: 'User Management',
            description: 'Manage user accounts, permissions, and access controls.'
          },
          'logs': {
            title: 'System Logs',
            description: 'View and analyze system logs, error reports, and activity monitoring.'
          },
          'security': {
            title: 'Security Center',
            description: 'Monitor security events, manage access controls, and review security policies.'
          },
          'database': {
            title: 'Database Management',
            description: 'Monitor database performance, manage connections, and view database statistics.'
          },
          'api': {
            title: 'API Console',
            description: 'Test API endpoints, view documentation, and monitor API usage.'
          },
          'monitoring': {
            title: 'System Monitoring',
            description: 'Monitor server performance, resource usage, and system health.'
          },
          'backups': {
            title: 'Backup Management',
            description: 'Manage system backups, schedule automated backups, and restore data.'
          },
          'account': {
            title: 'Account Settings',
            description: 'Manage your account preferences, security settings, and profile information.'
          },
          'system': {
            title: 'System Settings',
            description: 'Configure system-wide settings, preferences, and administrative options.'
          },
          'notifications': {
            title: 'Notification Settings',
            description: 'Manage notification preferences, alerts, and communication settings.'
          }
        };

        const config = pageConfigs[page] || pageConfigs['dashboard'];
        
        if (welcomeSection) {
          const titleElement = welcomeSection.querySelector('.welcome-title');
          const descriptionElement = welcomeSection.querySelector('p');
          
          if (titleElement) titleElement.textContent = config.title;
          if (descriptionElement) descriptionElement.textContent = config.description;
        }

        // Update dashboard grid content based on page
        if (dashboardGrid) {
          if (page === 'analytics') {
            await this.showAnalyticsContent(dashboardGrid);
          } else if (page === 'ip-data') {
            await this.showIPDataContent(dashboardGrid);
          } else {
            this.showDefaultContent(dashboardGrid);
          }
        }
      }

      async showAnalyticsContent(container) {
        // Show loading state
        container.innerHTML = `
          <div class="dashboard-card" style="grid-column: 1 / -1; text-align: center;">
            <div class="loading">
              <div class="spinner"></div>
              <p>Loading analytics data...</p>
            </div>
          </div>
        `;

        try {
          // Fetch server-side analytics data
          const response = await fetch('/api/analytics/summary');
          const analytics = await response.json();
          
          container.innerHTML = `
            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-eye"></i>
              </div>
              <h3 class="card-title">Total Page Views</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${analytics.totalPageViews || 0}
              </p>
            </div>

            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-users"></i>
              </div>
              <h3 class="card-title">Unique Visitors</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${analytics.totalUniqueVisitors || 0}
              </p>
            </div>

            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-calendar-day"></i>
              </div>
              <h3 class="card-title">Today's Views</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${analytics.todayPageViews || 0}
              </p>
            </div>

            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-user-plus"></i>
              </div>
              <h3 class="card-title">Today's Visitors</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${analytics.todayUniqueVisitors || 0}
              </p>
            </div>

            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-database"></i>
              </div>
              <h3 class="card-title">Total Sessions</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${analytics.totalSessions || 0}
              </p>
            </div>

            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-globe"></i>
              </div>
              <h3 class="card-title">IP Records</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${analytics.totalIPEntries || 0}
              </p>
            </div>

            <div class="dashboard-card" style="grid-column: 1 / -1;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div>
                  <div class="card-icon" style="margin-bottom: 0;">
                    <i class="fa-solid fa-chart-bar"></i>
                  </div>
                  <h3 class="card-title" style="margin-bottom: 0;">Analytics Summary</h3>
                </div>
                <button onclick="window.dashboardApp.showAnalyticsContent(document.querySelector('.dashboard-grid'))" 
                        style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e0e0e0; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                  <i class="fa-solid fa-refresh"></i> Refresh
                </button>
              </div>
              <div style="text-align: left;">
                <p><strong>First Visit:</strong> ${analytics.firstVisit ? new Date(analytics.firstVisit).toLocaleDateString() : 'N/A'}</p>
                <p><strong>Last Update:</strong> ${analytics.lastUpdate ? new Date(analytics.lastUpdate).toLocaleString() : 'N/A'}</p>
                <p><strong>Total IP Records:</strong> ${analytics.totalIPEntries || 0}</p>
                <p><strong>Total Browser Records:</strong> ${analytics.totalBrowserEntries || 0}</p>
                <p><strong>Total Sessions:</strong> ${analytics.totalSessions || 0}</p>
              </div>
            </div>

            ${analytics.recentCountries && analytics.recentCountries.length > 0 ? `
            <div class="dashboard-card" style="grid-column: 1 / -1;">
              <div class="card-icon">
                <i class="fa-solid fa-flag"></i>
              </div>
              <h3 class="card-title">Recent Countries</h3>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                ${analytics.recentCountries.slice(0, 6).map(country => `
                  <div style="background: rgba(255,255,255,0.05); padding: 0.75rem; border-radius: 8px; text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">${country.count}</div>
                    <div style="color: #aaa; font-size: 0.9rem;">${country.country}</div>
                  </div>
                `).join('')}
              </div>
            </div>
            ` : ''}

            ${analytics.topPages && analytics.topPages.length > 0 ? `
            <div class="dashboard-card" style="grid-column: 1 / -1;">
              <div class="card-icon">
                <i class="fa-solid fa-file-alt"></i>
              </div>
              <h3 class="card-title">Top Pages</h3>
              <div style="margin-top: 1rem;">
                ${analytics.topPages.slice(0, 5).map(page => `
                  <div style="background: rgba(255,255,255,0.05); padding: 0.75rem; margin: 0.5rem 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #e0e0e0;">${page.page}</span>
                    <span style="background: rgba(255,255,255,0.1); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.9rem;">${page.count} views</span>
                  </div>
                `).join('')}
              </div>
            </div>
            ` : ''}

            ${analytics.browserStats && analytics.browserStats.length > 0 ? `
            <div class="dashboard-card" style="grid-column: 1 / -1;">
              <div class="card-icon">
                <i class="fa-solid fa-browser"></i>
              </div>
              <h3 class="card-title">Browser Statistics</h3>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">
                ${analytics.browserStats.slice(0, 4).map(browser => `
                  <div style="background: rgba(255,255,255,0.05); padding: 0.75rem; border-radius: 8px; text-align: center;">
                    <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">${browser.count}</div>
                    <div style="color: #aaa; font-size: 0.8rem;">${browser.browser}</div>
                  </div>
                `).join('')}
              </div>
            </div>
            ` : ''}
          `;
        } catch (error) {
          console.error('Failed to load analytics data:', error);
          
          // Fallback to local analytics data
          const localAnalytics = window.NightDevAnalytics?.getAnalyticsSummary() || {};
          
          container.innerHTML = `
            <div class="dashboard-card" style="grid-column: 1 / -1;">
              <div class="card-icon">
                <i class="fa-solid fa-exclamation-triangle"></i>
              </div>
              <h3 class="card-title">Server Analytics Unavailable</h3>
              <p class="card-description" style="color: #ff6b6b; margin-bottom: 1rem;">
                Unable to connect to analytics server. Showing local data as fallback.
              </p>
              <div style="text-align: left;">
                <p><strong>Local Page Views:</strong> ${localAnalytics.totalPageViews || 0}</p>
                <p><strong>Local Unique Visitors:</strong> ${localAnalytics.totalUniqueVisitors || 0}</p>
                <p><strong>Error:</strong> ${error.message}</p>
              </div>
            </div>
          `;
        }
      }

      async showIPDataContent(container) {
        // Show loading state
        container.innerHTML = `
          <div class="dashboard-card" style="grid-column: 1 / -1; text-align: center;">
            <div class="loading">
              <div class="spinner"></div>
              <p>Loading IP data...</p>
            </div>
          </div>
        `;

        try {
          // Fetch detailed analytics data from server
          const response = await fetch('/api/analytics/detailed');
          const data = await response.json();
          
          const ipData = data.ipData || [];
          const sessions = data.sessions || [];
          const recentIPs = ipData.slice(-20); // Show last 20 IP entries
          
          // Get unique countries and cities
          const countries = [...new Set(ipData.map(entry => entry.country).filter(c => c && c !== 'Unknown'))];
          const cities = [...new Set(ipData.map(entry => entry.city).filter(c => c && c !== 'Unknown'))];
          const isps = [...new Set(ipData.map(entry => entry.isp).filter(i => i && i !== 'Unknown'))];
          
          // Get country statistics
          const countryStats = {};
          ipData.forEach(entry => {
            const country = entry.country || 'Unknown';
            countryStats[country] = (countryStats[country] || 0) + 1;
          });
          
          const topCountries = Object.entries(countryStats)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 8)
            .map(([country, count]) => ({ country, count }));

          // Get ISP statistics
          const ispStats = {};
          ipData.forEach(entry => {
            const isp = entry.isp || 'Unknown';
            ispStats[isp] = (ispStats[isp] || 0) + 1;
          });
          
          const topISPs = Object.entries(ispStats)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 6)
            .map(([isp, count]) => ({ isp, count }));
          
          container.innerHTML = `
            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-globe"></i>
              </div>
              <h3 class="card-title">Total IP Records</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${ipData.length}
              </p>
            </div>

            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-flag"></i>
              </div>
              <h3 class="card-title">Countries</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${countries.length}
              </p>
            </div>

            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-city"></i>
              </div>
              <h3 class="card-title">Cities</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${cities.length}
              </p>
            </div>

            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-network-wired"></i>
              </div>
              <h3 class="card-title">ISPs</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${isps.length}
              </p>
            </div>

            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-users"></i>
              </div>
              <h3 class="card-title">Total Sessions</h3>
              <p class="card-description" style="font-size: 2rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${sessions.length}
              </p>
            </div>

            <div class="dashboard-card">
              <div class="card-icon">
                <i class="fa-solid fa-clock"></i>
              </div>
              <h3 class="card-title">Latest Visit</h3>
              <p class="card-description" style="font-size: 1rem; font-weight: bold; color: #e0e0e0; margin: 1rem 0;">
                ${ipData.length > 0 ? new Date(ipData[ipData.length - 1].timestamp).toLocaleString() : 'No visits yet'}
              </p>
            </div>

            ${topCountries.length > 0 ? `
            <div class="dashboard-card" style="grid-column: 1 / -1;">
              <div class="card-icon">
                <i class="fa-solid fa-flag"></i>
              </div>
              <h3 class="card-title">Top Countries</h3>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-top: 1rem;">
                ${topCountries.map(country => `
                  <div style="background: rgba(255,255,255,0.05); padding: 0.75rem; border-radius: 8px; text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem; color: #4CAF50;">${country.count}</div>
                    <div style="color: #e0e0e0; font-size: 0.9rem; font-weight: 500;">${country.country}</div>
                  </div>
                `).join('')}
              </div>
            </div>
            ` : ''}

            ${topISPs.length > 0 ? `
            <div class="dashboard-card" style="grid-column: 1 / -1;">
              <div class="card-icon">
                <i class="fa-solid fa-network-wired"></i>
              </div>
              <h3 class="card-title">Top ISPs</h3>
              <div style="margin-top: 1rem;">
                ${topISPs.map(isp => `
                  <div style="background: rgba(255,255,255,0.05); padding: 0.75rem; margin: 0.5rem 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #e0e0e0; font-size: 0.9rem;">${isp.isp.length > 50 ? isp.isp.substring(0, 50) + '...' : isp.isp}</span>
                    <span style="background: rgba(255,255,255,0.1); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; color: #4CAF50;">${isp.count} visits</span>
                  </div>
                `).join('')}
              </div>
            </div>
            ` : ''}

            <div class="dashboard-card" style="grid-column: 1 / -1;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div>
                  <div class="card-icon" style="margin-bottom: 0;">
                    <i class="fa-solid fa-list"></i>
                  </div>
                  <h3 class="card-title" style="margin-bottom: 0;">Recent IP Data (Last 20 Visits)</h3>
                </div>
                <button onclick="window.dashboardApp.showIPDataContent(document.querySelector('.dashboard-grid'))" 
                        style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e0e0e0; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                  <i class="fa-solid fa-refresh"></i> Refresh
                </button>
              </div>
              <div style="max-height: 400px; overflow-y: auto;">
                ${recentIPs.length > 0 ? recentIPs.reverse().map(entry => `
                  <div style="background: rgba(255,255,255,0.05); padding: 0.75rem; margin: 0.5rem 0; border-radius: 8px; font-size: 0.9rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; align-items: center;">
                      <strong style="color: #4CAF50; font-family: monospace;">${entry.ip || 'Unknown'}</strong>
                      <span style="color: #aaa; font-size: 0.8rem;">${entry.timestamp ? new Date(entry.timestamp).toLocaleString() : ''}</span>
                    </div>
                    <div style="color: #ccc; line-height: 1.4;">
                      <div style="margin-bottom: 0.25rem;">📍 <strong>${entry.city || 'Unknown'}</strong>, ${entry.region || 'Unknown'}, ${entry.country || 'Unknown'} ${entry.countryCode ? '(' + entry.countryCode + ')' : ''}</div>
                      <div style="margin-bottom: 0.25rem;">🌐 <strong>ISP:</strong> ${entry.isp || 'Unknown ISP'}</div>
                      <div style="margin-bottom: 0.25rem;">🏢 <strong>Org:</strong> ${entry.org || 'Unknown'}</div>
                      <div style="margin-bottom: 0.25rem;">📄 <strong>Page:</strong> ${entry.page || '/'}</div>
                      ${entry.timezone ? `<div style="margin-bottom: 0.25rem;">🕐 <strong>Timezone:</strong> ${entry.timezone}</div>` : ''}
                      ${entry.userAgent ? `<div style="margin-bottom: 0.25rem; color: #999; font-size: 0.8rem;">🖥️ <strong>User Agent:</strong> ${entry.userAgent.length > 80 ? entry.userAgent.substring(0, 80) + '...' : entry.userAgent}</div>` : ''}
                      ${entry.asn ? `<div style="color: #888; font-size: 0.8rem;">🔢 <strong>ASN:</strong> ${entry.asn}</div>` : ''}
                    </div>
                  </div>
                `).join('') : '<p style="color: #aaa; text-align: center; padding: 2rem;">No IP data available yet.</p>'}
              </div>
            </div>
          `;
        } catch (error) {
          console.error('Failed to load IP data:', error);
          
          // Fallback to local IP data
          const localIPData = window.NightDevAnalytics?.getIPData() || [];
          
          container.innerHTML = `
            <div class="dashboard-card" style="grid-column: 1 / -1;">
              <div class="card-icon">
                <i class="fa-solid fa-exclamation-triangle"></i>
              </div>
              <h3 class="card-title">Server IP Data Unavailable</h3>
              <p class="card-description" style="color: #ff6b6b; margin-bottom: 1rem;">
                Unable to connect to analytics server. Showing local IP data as fallback.
              </p>
              <div style="text-align: left;">
                <p><strong>Local IP Records:</strong> ${localIPData.length}</p>
                <p><strong>Error:</strong> ${error.message}</p>
                <p style="color: #aaa; font-size: 0.9rem; margin-top: 1rem;">
                  Note: Local IP data may not include real IP addresses or detailed geolocation information.
                  Start the server with <code>npm start</code> to get accurate server-side IP tracking.
                </p>
              </div>
            </div>
          `;
        }
      }

      showDefaultContent(container) {
        container.innerHTML = `
          <div class="dashboard-card">
            <div class="card-icon">
              <i class="fa-solid fa-project-diagram"></i>
            </div>
            <h3 class="card-title">Projects</h3>
            <p class="card-description">Manage your development projects, view progress, and access project files.</p>
          </div>

          <div class="dashboard-card">
            <div class="card-icon">
              <i class="fa-solid fa-chart-line"></i>
            </div>
            <h3 class="card-title">Analytics</h3>
            <p class="card-description">View performance metrics, user statistics, and development insights.</p>
          </div>

          <div class="dashboard-card">
            <div class="card-icon">
              <i class="fa-solid fa-cog"></i>
            </div>
            <h3 class="card-title">Settings</h3>
            <p class="card-description">Configure your development environment, preferences, and account settings.</p>
          </div>

          <div class="dashboard-card">
            <div class="card-icon">
              <i class="fa-solid fa-tools"></i>
            </div>
            <h3 class="card-title">Developer Tools</h3>
            <p class="card-description">Access debugging tools, API testing, and development utilities.</p>
          </div>

          <div class="dashboard-card">
            <div class="card-icon">
              <i class="fa-solid fa-users"></i>
            </div>
            <h3 class="card-title">Team</h3>
            <p class="card-description">Manage team members, permissions, and collaborative development.</p>
          </div>

          <div class="dashboard-card">
            <div class="card-icon">
              <i class="fa-solid fa-file-code"></i>
            </div>
            <h3 class="card-title">Documentation</h3>
            <p class="card-description">Access project documentation, API references, and development guides.</p>
          </div>
        `;
      }

      logout() {
        // Clear session data
        localStorage.removeItem('nightdev_session');
        sessionStorage.removeItem('nightdev_session');
        
        // Redirect to home page
        window.location.href = 'index.html';
      }

      redirectToLogin() {
        // Redirect to index with auth warning
        window.location.href = 'index.html?auth=required';
      }
    }

    // Show coming soon message
    function showComingSoon(featureName) {
      // Create modal overlay
      const overlay = document.createElement('div');
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(10px);
      `;

      // Create modal content
      const modal = document.createElement('div');
      modal.style.cssText = `
        background: linear-gradient(135deg, rgba(26, 26, 26, 0.95) 0%, rgba(26, 26, 26, 0.9) 100%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 3rem;
        text-align: center;
        max-width: 500px;
        margin: 2rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(20px);
      `;

      modal.innerHTML = `
        <div style="font-size: 4rem; color: #ffc107; margin-bottom: 1.5rem;">
          <i class="fa-solid fa-clock"></i>
        </div>
        <h2 style="color: #e0e0e0; margin-bottom: 1rem; font-size: 1.8rem;">
          ${featureName}
        </h2>
        <p style="color: #aaa; margin-bottom: 2rem; font-size: 1.1rem;">
          This feature is currently under development and will be available soon!
        </p>
        <p style="color: #888; margin-bottom: 2rem; font-size: 0.95rem;">
          We're working hard to bring you the best experience. Stay tuned for updates!
        </p>
        <button onclick="this.closest('.modal-overlay').remove()" style="
          background: linear-gradient(135deg, #2a2a2a, #404040);
          border: 1px solid rgba(255, 255, 255, 0.1);
          color: #e0e0e0;
          padding: 1rem 2rem;
          border-radius: 12px;
          font-size: 1rem;
          cursor: pointer;
          transition: all 0.3s ease;
        " onmouseover="this.style.background='linear-gradient(135deg, #404040, #555555)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='linear-gradient(135deg, #2a2a2a, #404040)'; this.style.transform='translateY(0)'">
          <i class="fa-solid fa-check"></i>
          Got it!
        </button>
      `;

      overlay.className = 'modal-overlay';
      overlay.appendChild(modal);
      document.body.appendChild(overlay);

      // Close on overlay click
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.remove();
        }
      });

      // Close on escape key
      const handleEscape = (e) => {
        if (e.key === 'Escape') {
          overlay.remove();
          document.removeEventListener('keydown', handleEscape);
        }
      };
      document.addEventListener('keydown', handleEscape);
    }

    // Initialize dashboard when page loads
    document.addEventListener('DOMContentLoaded', () => {
      window.dashboardApp = new Dashboard();
    });

    // Prevent back button after logout
    window.addEventListener('pageshow', (event) => {
      if (event.persisted) {
        window.location.reload();
      }
    });
  </script>
</body>
</html>