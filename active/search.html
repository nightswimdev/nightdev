<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <title>nightdev | Search</title>
    <link rel="stylesheet" href="index.css" />
    <link rel="icon" type="image/x-icon" href="/assets/js/icon/Untitled design (14)-Picsart-BackgroundRemover.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
        min-height: 100vh;
        color: white;
      }

      .home-navbar {
        transform: translateX(-50%);
        width: 670px;
        top: 1%;
        margin-bottom: -10px;
        margin-left: 50%;
        background-color: #08080894;
        border: 1px solid #ffffff21;
        height: 35px;
        color: #818181;
        padding: 10px;
        text-align: center;
        font-size: 18px;
        font-weight: bold;
        z-index: 1001;
        backdrop-filter: blur(5px);
        border-radius: 25px;
        position: fixed;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: transform 0.3s ease;
      }

      .home-navbar .favicon {
        width: 24px;
        height: 24px;
        margin-right: -10px;
        vertical-align: middle;
      }

      .home-navbar a {
        color: #7c7c7c;
        text-decoration: none;
        padding: 8px 16px;
        font-size: 14px;
        font-weight: 300;
        border-radius: 5px;
        position: relative;
        transition: all 0.3s ease;
      }

      .home-navbar a:hover {
        color: #bbbbbb;
        font-size: 16px;
      }

      .home-navbar a:active {
        font-size: 12px;
      }

      .home-navbar i {
        color: #ffffff; 
        margin-right: -15px;
        margin-left: 115px;
      }

      .navbar {
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #40296b3b;
        backdrop-filter: blur(10px);
        border: 1px solid #36216e80;
        width: 900px;
        max-width: 98vw;
        display: block;
        border-radius: 25px;
        align-items: center;
        overflow: hidden;
        position: fixed;
        z-index: 999;
        animation: fadeIn 0.3s ease;
        padding: 0.5em 1em;
      }
      .nav-buttons {
        list-style: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5em;
      }
      .nav-buttons li {
        display: flex;
        align-items: center;
      }
      .nav-buttons a {
        color: #eceff4;
        text-decoration: none;
        padding: 0.4em 0.7em;
        border-radius: 1em;
        transition: background 0.15s, color 0.15s, font-size 0.15s;
        font-size: 1.1em;
        display: flex;
        align-items: center;
      }
      .nav-buttons a:hover, .nav-buttons a.active {
        background: #c4c4c4b7;
        color: #242424;
        font-size: 1.18em;
      }
      .nav-buttons a.disabled {
        opacity: 0.5;
        pointer-events: none;
      }
      .small-searchbar {
        display: flex;
        align-items: center;
        background: #0000007c;
        border-radius: 1.2em;
        padding: 0.2em 0.7em;
        min-width: 228px;
        max-width: 320px;
        margin: 0 0.5em;
        position: relative;
      }
      .small-searchbar #lock-indicator {
        position: absolute;
        left: 0.9em;
        top: 50%;
        transform: translateY(-60%);
        display: flex;
        align-items: center;
        z-index: 2;
      }
      .small-searchbar #lock-svg {
        position: static;
      }
      .small-searchbar input {
        background: transparent;
        border: none;
        color: #eceff4;
        font-size: 1em;
        width: 100%;
        outline: none;
        padding-left: 1.6em !important;
      }
      .small-searchbar svg {
        position: absolute;
        left: 0.7em;
        color: #bfc9db;
        font-size: 1em;
        width: 1em;
        height: 1em;
      }
      .shortcut-indicator-2 {
        font-size: 0.8em;
        color: #bfc9db;
        margin-left: 0.5em;
        white-space: nowrap;
      }
      .iframe-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 1;
        background: #222;
      }
      #cool-iframe {
        width: 100vw;
        height: 100vh; /* changed to full viewport to remove bottom gap */
        border: none;
        background: #222;
        display: block;
      }
      @media (max-width: 1000px) {
        .navbar {
          width: 99vw;
          min-width: 0;
          padding: 0.2em 0.2em;
        }
        .small-searchbar {
          min-width: 120px;
          max-width: 180px;
        }
      }

      /* New styles for the navigation controls */
      .nav-controls {
        position: fixed;
        top: 70px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 1000;
      }

      .nav-controls button {
        background: #333;
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background 0.3s, transform 0.3s;
      }

      .nav-controls button:hover {
        background: #444;
      }

      .nav-controls button:active {
        transform: scale(0.98);
      }
    </style>
  </head>
  <body style="background:#222;">
    <div class="navbar" style="display: block;">
      <ul class="nav-buttons">
        <li><a id="backIcon" href="#" class="disabled" title="Back"><i class="fa-solid fa-arrow-left"></i></a></li>
        <li><a id="refreshIcon" href="#" title="Refresh"><i class="fa-solid fa-rotate-right"></i></a></li>
        <li><a id="forwardIcon" href="#" class="disabled" title="Forward"><i class="fa-solid fa-arrow-right"></i></a></li>
        <li><a id="fullscreenIcon" href="#" title="Fullscreen"><i class="fa-solid fa-expand"></i></a></li>
        <li>
          <div class="small-searchbar" style="position: relative;">
            <span id="lock-indicator" title="Connection is secure">
              <svg id="lock-svg" viewBox="0 0 24 24" width="16" height="16">
                <path d="M17 11V7a5 5 0 0 0-10 0v4" stroke="#4caf50" stroke-width="2" fill="none"/>
                <rect x="5" y="11" width="14" height="10" rx="2" stroke="#4caf50" stroke-width="2" fill="none"/>
              </svg>
            </span>
            <input class="waves" type="text" id="searchInputt" placeholder="Search for a query or enter a URL..." autocomplete="off" style="padding-left: 40px;">
            <span class="shortcut-indicator-2">Ctrl + S</span>
          </div>
        </li>
        <li><a href="/index.html" title="Home"><i class="fa-solid fa-house"></i></a></li>
        <li><a href="/apps.html" title="Apps"><i class="fa-solid fa-th"></i></a></li>
        <li><a id="erudaIcon" href="#" title="Dev Tools"><i class="fa-solid fa-code"></i></a></li>
      </ul>
    </div>

    <!-- iframe: now full height (no extra space below) -->
    <iframe id="cool-iframe"></iframe>

    <!-- Ultraviolet scripts first -->
    <script src="/active/uv/uv.bundle.js"></script>
    <script src="/active/uv/uv.config.js"></script>
    <script src="/active/uv/uv.handler.js"></script>

    <script>
    // consolidated script (replaces duplicated/removed blocks)
    document.addEventListener('DOMContentLoaded', async () => {
      const iframe = document.getElementById('cool-iframe');

      function isValidHttpUrl(string) {
        try { const u = new URL(string); return u.protocol === 'http:' || u.protocol === 'https:'; }
        catch { return false; }
      }

      function buildUrl(input) {
        // Normalize input and convert bare domains -> https, treat empty as duckduckgo homepage
        if (input == null || input.trim() === '') return 'https://duckduckgo.com';
        input = decodeURIComponent(input.trim());
        if (/^[\w-]+\.[\w.-]+(?:\/.*)?$/.test(input) && !/^https?:\/\//i.test(input)) {
          input = 'https://' + input;
        }
        if (isValidHttpUrl(input)) return input;
        return 'https://duckduckgo.com/?q=' + encodeURIComponent(input);
      }

      const params = new URLSearchParams(window.location.search);
      const userInput = params.get('url');
      const finalUrl = buildUrl(userInput);

      // always have a default (duckduckgo) instead of aborting
      if (!finalUrl) {
        console.error('No URL provided, falling back to duckduckgo.');
      }

      // wait for Ultraviolet config/encodeUrl to be available
      let tries = 0;
      while ((typeof window.__uv$config === 'undefined' || typeof window.__uv$config.encodeUrl !== 'function') && tries < 50) {
        await new Promise(r => setTimeout(r, 100));
        tries++;
      }

      if (typeof window.__uv$config === 'undefined' || typeof window.__uv$config.encodeUrl !== 'function') {
        console.error('Proxy config not ready. Reload the page.', window.__uv$config);
        // still attempt to load duckduckgo directly if proxy not ready
        iframe.src = 'https://duckduckgo.com';
        return;
      }

      try {
        new URL(finalUrl); // sanity check
        iframe.src = window.__uv$config.prefix + window.__uv$config.encodeUrl(finalUrl);
        localStorage.setItem('lastUvUrl', finalUrl);
      } catch (err) {
        console.error('Invalid URL:', finalUrl, err);
        // fallback to duckduckgo homepage
        try { iframe.src = window.__uv$config.prefix + window.__uv$config.encodeUrl('https://duckduckgo.com'); }
        catch { iframe.src = 'https://duckduckgo.com'; }
      }

      // navbar handlers
      const backBtn = document.getElementById('backIcon');
      const forwardBtn = document.getElementById('forwardIcon');
      const refreshBtn = document.getElementById('refreshIcon');
      const fullscreenBtn = document.getElementById('fullscreenIcon');

      if (backBtn) backBtn.addEventListener('click', e => { e.preventDefault(); window.history.back(); });
      if (forwardBtn) forwardBtn.addEventListener('click', e => { e.preventDefault(); window.history.forward(); });
      if (refreshBtn) refreshBtn.addEventListener('click', e => { e.preventDefault(); iframe.src = iframe.src; });
      if (fullscreenBtn) fullscreenBtn.addEventListener('click', e => {
        e.preventDefault();
        if (iframe.requestFullscreen) iframe.requestFullscreen();
      });

      // small search bar (top navbar) behavior
      const searchInput = document.getElementById('searchInputt');
      if (searchInput) {
        const lastUvUrl = localStorage.getItem('lastUvUrl');
        if (lastUvUrl) searchInput.value = lastUvUrl;

        searchInput.addEventListener('keydown', function(e) {
          if (e.key === "Enter") {
            e.preventDefault();
            const newVal = searchInput.value.trim();
            if (!newVal) return;
            localStorage.setItem('lastUvUrl', newVal);

            let url;
            try { url = new URL(newVal).toString(); }
            catch { url = `https://duckduckgo.com/?q=${encodeURIComponent(newVal)}`; }

            // navigate to same page with proper query param (will be normalized by this script)
            window.location.href = '/active/search.html?url=' + encodeURIComponent(url);
          }
        });
      }

      // eruda init (do not attach to iframe)
      if (typeof eruda !== 'undefined') {
        try { eruda.init(); } catch (e) { /* ignore eruda attach errors */ }
      }
    });
    </script>

    <!-- optionally load eruda; safe init is handled above -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
  </body>
</html>
