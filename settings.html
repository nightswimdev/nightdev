<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>nightdev | Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="index.css">
  <!-- added: Font Awesome for the navbar icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="/assets/js/icon/Untitled design (14)-Picsart-BackgroundRemover.png">
  <style>
    body { background: #23242a; color: #eceff4; font-family: 'Segoe UI', Arial, sans-serif; margin:0; padding:0; }
    .settings-container { max-width:640px; margin:120px auto; background:rgba(40,44,52,0.97); border-radius:1em; box-shadow:0 6px 30px rgba(0,0,0,0.2); padding:2em; }
    h1 { text-align:center; margin-bottom:1rem; font-size:1.8rem; }
    .setting-group { margin-bottom:1.25rem; }
    .setting-label { display:block; font-weight:700; margin-bottom:0.35rem; }
    .setting-desc { color:#bfc9db; font-size:0.95rem; margin-bottom:0.6rem; }
    .setting-actions { display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap; }
    .input-short { padding:0.45em 0.7em; border-radius:0.6em; border:none; background:#434c5e; color:#eceff4; }
    .btn { background:#5e81ac; color:#fff; border:none; border-radius:0.7em; padding:0.45em 0.9em; cursor:pointer; }
    .btn.secondary { background:#4c566a; }
    .proxy-list { background:#2e3440; border-radius:0.6em; padding:0.8em; margin-top:0.6em; color:#bfc9db; font-size:0.95rem; }
    .row { display:flex; gap:0.6rem; align-items:center; flex-wrap:wrap; }
    label.switch { display:flex; align-items:center; gap:0.6rem; cursor:pointer; }
    select.input-short { height:36px; }
  </style>
</head>
<body>
  <!-- moved navbar here so icons/styles load correctly -->
  <div class="navbar main-navbar">
    <div class="main-navbar-title">
      <img src="assets/js/icon/Untitled design (14)-Picsart-BackgroundRemover.png" alt="nightdev logo" class="main-navbar-logo" />
      <span>nightdev</span>
    </div>
    <ul class="nav-buttons">
      <li><a href="index.html" title="Home"><i class="fa-solid fa-house"></i></a></li>
      <li><a href="apps.html" title="Apps"><i class="fa-solid fa-th"></i></a></li>
      <li><a href="settings.html" class="active" title="Settings"><i class="fa-solid fa-gear"></i></a></li>
      <li>
        <a href="ai.html" title="AI">
          <i class="fa-solid fa-robot"></i>
        </a>
      </li>
    </ul>
  </div>

  <div class="settings-container" id="settingsContainer">
    <h1>Settings</h1>

    <!-- 1) Panic Key -->
    <div class="setting-group">
      <span class="setting-label">Panic Key</span>
      <div class="setting-desc">Quickly hide the site by pressing this key (opens about:blank in same tab).</div>
      <div class="setting-actions">
        <input id="panicKey" class="input-short" maxlength="1" placeholder="Key" autocomplete="off">
        <button class="btn" id="setPanicBtn">Set</button>
        <span id="panicKeyStatus" style="color:#a3be8c;"></span>
      </div>
    </div>

    <!-- 2) Default Search Engine -->
    <div class="setting-group">
      <span class="setting-label">Default Search Engine</span>
      <div class="setting-desc">Choose the engine used for plain searches (domains still open directly).</div>
      <div class="setting-actions">
        <select id="defaultEngine" class="input-short">
          <option value="https://duckduckgo.com">DuckDuckGo</option>
          <option value="https://www.google.com">Google</option>
          <option value="https://www.bing.com">Bing</option>
        </select>
        <button class="btn" id="setEngineBtn">Save</button>
        <span id="engineStatus" style="color:#a3be8c;"></span>
      </div>
    </div>

    <!-- 3) about:blank Cloak -->
    <div class="setting-group">
      <span class="setting-label">about:blank Cloak</span>
      <div class="setting-desc">Open the site in a new about:blank tab (site content loaded inside an iframe).</div>
      <div class="setting-actions">
        <button class="btn" id="aboutBlankBtn">Open in about:blank</button>
        <button class="btn secondary" id="testCloakBtn">Test</button>
      </div>
    </div>

    <!-- 4) Proxy Features -->
    <div class="setting-group">
      <span class="setting-label">Proxy Features</span>
      <div class="setting-desc">Change the proxy prefix or bare server used by the Ultraviolet frontend (advanced).</div>
      <div class="setting-actions row">
        <input id="proxyPrefix" class="input-short" placeholder="/service/" autocomplete="off">
        <input id="proxyBare" class="input-short" placeholder="https://mybare.example/bare/" autocomplete="off" style="min-width:220px;">
        <button class="btn" id="setProxyBtn">Set</button>
        <span id="proxyPrefixStatus" style="color:#a3be8c;"></span>
      </div>
      <div class="proxy-list">
        <b>Current Prefix:</b> <span id="currentPrefix"></span><br>
        <b>Bare Server:</b> <span id="bareServer"></span>
      </div>
    </div>

    <!-- 5) Hide Navbar When Searching -->
    <div class="setting-group">
      <span class="setting-label">Hide Navbar When Searching</span>
      <div class="setting-desc">When enabled, the navbar hides while using the search bar for a cleaner interface.</div>
      <div class="setting-actions">
        <label class="switch"><input type="checkbox" id="hideNavbarOnSearch"><span>Enable</span></label>
        <span id="hideNavbarStatus" style="color:#a3be8c;"></span>
      </div>
    </div>

  </div>

  <script>
    // Persistence helpers
    function setLocal(key, value){ localStorage.setItem(key, value); }
    function getLocal(key, def){ const v = localStorage.getItem(key); return v === null ? def : v; }

    // Panic key
    (function(){
      const panicInput = document.getElementById('panicKey');
      const status = document.getElementById('panicKeyStatus');
      const btn = document.getElementById('setPanicBtn');
      panicInput.value = getLocal('panicKey','');
      status.textContent = panicInput.value ? `Set to "${panicInput.value.toUpperCase()}"` : '';
      btn.addEventListener('click', () => {
        const k = panicInput.value.trim().toLowerCase();
        if(!k){ status.textContent = ''; localStorage.removeItem('panicKey'); return; }
        setLocal('panicKey', k);
        status.textContent = `Set to "${k.toUpperCase()}"`;
      });
      document.addEventListener('keydown', function(e){
        const pk = getLocal('panicKey','');
        if(pk && e.key.toLowerCase() === pk) window.open('about:blank','_self');
      });
    })();

    // Default engine
    (function(){
      const sel = document.getElementById('defaultEngine');
      const btn = document.getElementById('setEngineBtn');
      const status = document.getElementById('engineStatus');
      sel.value = getLocal('defaultEngine','https://duckduckgo.com');
      status.textContent = 'Saved';
      btn.addEventListener('click', () => {
        setLocal('defaultEngine', sel.value);
        status.textContent = 'Saved';
        setTimeout(()=> status.textContent = '', 1800);
      });
    })();

    // about:blank cloak
    document.getElementById('aboutBlankBtn').addEventListener('click', function(){
      const win = window.open('about:blank','_blank');
      if(!win){ alert('Popup blocked. Allow popups and try again.'); return; }
      const iframe = win.document.createElement('iframe');
      iframe.style.cssText = 'position:fixed;top:0;left:0;width:100vw;height:100vh;border:none;margin:0;';
      iframe.src = window.location.href;
      win.document.body.style.margin = '0';
      win.document.body.appendChild(iframe);
      win.document.title = "about:blank";
    });
    document.getElementById('testCloakBtn').addEventListener('click', function(){
      alert('Opens a test about:blank tab with current site loaded inside. If popup blocked, allow popups.');
      document.getElementById('aboutBlankBtn').click();
    });

    // Proxy prefix and bare
    (function(){
      const prefixIn = document.getElementById('proxyPrefix');
      const bareIn = document.getElementById('proxyBare');
      const setBtn = document.getElementById('setProxyBtn');
      const status = document.getElementById('proxyPrefixStatus');
      const currentPrefix = document.getElementById('currentPrefix');
      const bareServer = document.getElementById('bareServer');

      function updateProxyInfo(){
        const storedPrefix = getLocal('uvPrefix', '');
        const prefix = storedPrefix || (window.__uv && window.__uv.config && window.__uv.config.prefix) || (window.__uv$config && window.__uv$config.prefix) || '/service/';
        const storedBare = getLocal('uvBare', '');
        const bare = storedBare || (window.__uv && window.__uv.config && window.__uv.config.bare) || (window.__uv$config && window.__uv$config.bare) || '/bare/';
        currentPrefix.textContent = prefix;
        bareServer.textContent = bare;
        prefixIn.value = storedPrefix || '';
        bareIn.value = storedBare || '';
      }
      updateProxyInfo();

      setBtn.addEventListener('click', function(){
        const p = prefixIn.value.trim();
        const b = bareIn.value.trim();
        if(p) setLocal('uvPrefix', p); else localStorage.removeItem('uvPrefix');
        if(b) setLocal('uvBare', b); else localStorage.removeItem('uvBare');
        status.textContent = 'Saved';
        updateProxyInfo();
        setTimeout(()=> status.textContent = '', 1800);
      });
    })();

    // Hide navbar setting
    (function(){
      const chk = document.getElementById('hideNavbarOnSearch');
      const stat = document.getElementById('hideNavbarStatus');
      const saved = getLocal('hideNavbarOnSearch','false') === 'true';
      chk.checked = saved;
      stat.textContent = saved ? 'Enabled' : 'Disabled';
      chk.addEventListener('change', function(){
        setLocal('hideNavbarOnSearch', chk.checked ? 'true' : 'false');
        stat.textContent = chk.checked ? 'Enabled' : 'Disabled';
      });
    })();

    // initialize view values that depend on uv config
    (function(){
      // small delay to allow uv.config to appear if present
      setTimeout(()=> {
        try { document.getElementById('currentPrefix').textContent = localStorage.getItem('uvPrefix') || (window.__uv$config && window.__uv$config.prefix) || document.getElementById('currentPrefix').textContent; }
        catch(e){}
      }, 200);
    })();
  </script>

  <script src="intro-anim.js"></script>
</body>
</html>